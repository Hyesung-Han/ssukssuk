<!-- /server/sql/base/base.xml -->

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MYFARM">  

  <select id="MYFARM.SELECT.myfarmdetail">
  	/* 내 농장 상세보기 */
    SELECT  
        *
    FROM my_farm_t
    <WHERE>
      <if test="no != undefined">farm_no = #{no} and</if> 
      user_id = #{id}
    </WHERE>
    order by farm_no asc
    LIMIT 1
  </select>

  <select id="MYFARM.SELECT.myfarmlist">
    /* 내 농장 전체 목록 */ 
    SELECT  
        farm_no,
        user_id,
        farm_name,
        farm_text,
        farm_regidate
    FROM my_farm_t
    <where>
      user_id = #{id}
    <if test="keyword != undefined"> and (farm_name like concat('%',#{keyword}, '%')
    or farm_text like concat('%',#{keyword}, '%'))</if>
    </where>
    order by farm_no asc;
  </select>

  <update id = "MYFARM.UPDATE.myfarmupdate">
  /* 내 농장 정보 수정 */
      update my_farm_t set
      farm_name = #{name},
      farm_text = #{text}
      where farm_no = #{no}
  </update>


  <delete id="MYFARM.DELETE.myfarmdelete">
    /* 내 농장 정보 삭제 */
    Delete
    From my_farm_t
    Where farm_no = #{no}
  </delete>

  <select id="MYFARM.SELECT.image">
  	/* 농장 이미지 검색 */
    SELECT  
        file_name
    FROM myfarm_image_t
    where farm_no = #{farm_no}
  </select>

   <insert id="MYFARM.INSERT.image">
    INSERT INTO myfarm_image_t
    (
        farm_no,
        file_name,
        file_path,
        file_type,
        file_size,
        file_date
    )
    VALUES
    (
        #{farm_no}, 
        #{file_name},
        #{file_path}, 
        #{file_type},
        #{file_size},
        now()
    )
  </insert>

  <delete id="MYFARM.DELETE.image">
    /* 내 농장 이미지 삭제 */
    Delete
    From myfarm_image_t
    Where farm_no = #{farm_no}
  </delete>


</mapper>